<% content_for :title, @current_category ? "#{@current_category.name} - Software Crackz" : "Software Crackz" %>

<!-- Page Header -->
<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-white mb-2">
        <% if @current_category %>
          <%= @current_category.name %>
        <% else %>
          Latest Software
        <% end %>
      </h1>
      <p class="text-gray-400">
        <%= pluralize(@softwares.count, 'software') %> available
        <% if @current_category %>
          in <%= @current_category.name %>
        <% end %>
      </p>
    </div>
    
    <% if @current_category %>
      <div class="text-right">
        <%= link_to "← All Categories", root_path, 
            class: "text-green-400 hover:text-green-300 transition-colors" %>
      </div>
    <% end %>
  </div>
  
  <% if @current_category&.description.present? %>
    <div class="mt-4 p-4 bg-gray-800 rounded-lg border border-gray-700">
      <p class="text-gray-300"><%= @current_category.description %></p>
    </div>
  <% end %>
</div>

<!-- Software Grid -->
<% if @softwares.any? %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @softwares.each do |software| %>
      <div class="software-card">
        <!-- Featured Image -->
        <div class="relative">
          <% if software.featured_image.attached? %>
            <%= image_tag software.featured_image.variant(resize_to_fill: [400, 250]), 
                alt: software.title, 
                class: "w-full h-48 object-cover" %>
          <% elsif software.screenshots.attached? %>
            <%= image_tag software.screenshots.first.variant(resize_to_fill: [400, 250]), 
                alt: software.title, 
                class: "w-full h-48 object-cover" %>
          <% else %>
            <div class="w-full h-48 bg-gray-700 flex items-center justify-center">
              <svg class="w-16 h-16 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" clip-rule="evenodd"/>
              </svg>
            </div>
          <% end %>
          
          <!-- Category Badge -->
          <div class="absolute top-2 left-2">
            <span class="bg-green-600 text-white px-2 py-1 rounded text-xs font-medium">
              <%= software.category.name %>
            </span>
          </div>
        </div>
        
        <!-- Card Content -->
        <div class="p-6 flex-grow flex flex-col">
          <h3 class="text-xl font-semibold text-white mb-2">
            <%= link_to software.title, software_path(software), 
                class: "hover:text-green-400 transition-colors" %>
          </h3>
          
          <!-- Meta Information -->
          <div class="space-y-1 mb-3 text-sm text-gray-400">
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L10 9.586V6z" clip-rule="evenodd"/>
              </svg>
              <span>v<%= software.version %></span>
              <span class="mx-2">•</span>
              <svg class="w-4 h-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v1a1 1 0 01-1 1H4a1 1 0 01-1-1v-1zM3 7a1 1 0 011-1h12a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V7zM4 3a1 1 0 000 2h12a1 1 0 100-2H4z" clip-rule="evenodd"/>
              </svg>
              <span><%= software.downloads_count %> downloads</span>
            </div>
            
            <% if software.file_size.present? %>
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15.586 13H14a1 1 0 01-1-1z" clip-rule="evenodd"/>
                </svg>
                <span>File size: <%= number_to_human_size(software.file_size) %></span>
              </div>
            <% end %>
          </div>
          
          <!-- Description -->
          <p class="text-gray-300 mb-4 text-sm leading-relaxed">
            <%= truncate(software.description, length: 120) %>
          </p>
          
          <!-- Developer -->
          <% if software.developer.present? %>
            <p class="text-xs text-gray-500 mb-4">
              by <%= software.developer %>
            </p>
          <% end %>
          
          <!-- Action Button -->
          <div class="flex space-x-2 mt-auto">
            <%= link_to "View Details", software_path(software), 
                class: "download-button flex-1 text-center" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- Empty State -->
  <div class="text-center py-16">
    <div class="max-w-md mx-auto">
      <svg class="w-24 h-24 mx-auto text-gray-600 mb-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" clip-rule="evenodd"/>
      </svg>
      <h3 class="text-xl font-semibold text-gray-400 mb-2">No software found</h3>
      <p class="text-gray-500">
        <% if @current_category %>
          No software available in this category yet.
        <% else %>
          No software available yet. Check back later!
        <% end %>
      </p>
      <div class="mt-6">
        <%= link_to "← Browse All Categories", root_path, 
            class: "text-green-400 hover:text-green-300 transition-colors" %>
      </div>
    </div>
  </div>
<% end %>